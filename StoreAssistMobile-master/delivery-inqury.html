<!DOCTYPE html>
<html lang="ko">
<head>
<title>배달료 사용 내역</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densitydpi=medium-dpi, shrink-to-fit=no">
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="Cache-Control" content="no-cache,no-store" />

<meta name="writer" content="">
<meta name="title" content="" />
<meta name="description" content="" />
<meta name="keywords" content="" />
<meta name="author" content="" />
<meta name="format-detection" content="telephone=no" />

<meta property="og:title" content=""/>
<meta property="og:type" content=""/>
<meta property="og:url" content=""/>
<meta property="og:description" content=""/>
<meta property="og:image" content=""/>


<!-- link -->
<link href="css/swiper.min.css" rel="stylesheet">
<link href="css/common.css" rel="stylesheet">


<script src="js/jquery-1.12.4.min.js"></script>
<script src="js/swiper.min.js"></script>
<script src="js/common.js"></script>
</head>
<body>
<div id="wrap">


<header id="header" class="header">
	<div class="inr-c">
		<button type="button" class="btn-back"><span>뒤로</span></button>
		<h1 class="tit">배달료 사용 내역</h1>
	</div>
</header><!--//header -->

<div id="container" class="container main">

	<!-- 상단 카드부분 -->
	<div class="pt20 pb25" style="background-color:#FFF4FB;">
		<div class="top_tit_calendar">
			<div class="inr-c">
				<div class="tit_yeas">
					<button type="button" class="btn_yeas" onclick="openLayerPopup('popYears'); return false;"><span id="sel_yyyymm">2022년 9월</span></button>
					<button type="button" class="btn_prev"><span>이전</span></button>
					<button type="button" class="btn_next"><span>다음</span></button>
				</div>
			</div>
		</div>


		<div class="top_card">
			<div class="inr-c">
				<div class="box">
					<div class="card_contents">
						<div class="flex aic jcsb mb8">
							<div class="textbox_mc"><span>총 이용 배달료</span></div>
							<div class="price_text_mc" value="" name="총 이용 배달료" id="price_total">-391,000</div>
						</div>
					<div class="flex aic jcsb">
						<span>총 건수</span>
						<span id="tot_cnt">31건</span>
					</div>
				</div>
				</div>
			</div>
		</div>
	</div>	
	
	

	<!-- 내역 -->
	<div class="tit_calendar">
		<div class="inr-c">
			<div class="txt_btn">
				<button type="button" class="btn_tx" id="btn_refresh"><span class="ico_ i_refresh">총 <span class="c-red" id="tot_cnt2">51</span>건</span></button>
				<div class="rgh">
					<button type="button" class="btn_tx" onclick="openLayerPopup('popSetting'); return false;"><span class="ico_ i_sort">전체·최신순</span></button>
				</div>
			</div>
		</div>
	</div>


	<div class="lst_card">
		<ul id="list_main">
			<li>
				<p class="t_day">5월 15일</p>
				<div class="l_card">
					<p class="t0">
						<span class="lft">01515050</span>
						<span class="rgh" name="배민">배민
						<span>ㅣ</span>
						<span name="선결제">선결제</span>
						<span>ㅣ</span>
						<span name="포장">포장</span>
						</span>
					</p>
					<p class="t1">
						<span class="tt1 lft fw600 c-black">별내동 1005, 아이파크스타타워123ㄴㄴㄴㄴㄴㄴㄴㄴㄴㄴ</span>
						<span class="rgh fw800 c-red">-5,400원</span>
					</p>
					<p class="t2">
						<span class="lft"><span class="mr10">음식금액</span>144,000원</span></span>
						<span class="rgh" name="딜리온">딜리온
						<span>ㅣ</span>
						<span name="이형규기사">이형규기사</span>
						</span>
					</p>
				</div>
				<div class="l_card">
					<p class="t0">
						<span class="lft">01515050</span>
						<span class="rgh" name="배민">배민
						<span>ㅣ</span>
						<span name="선결제">선결제</span>
						<span>ㅣ</span>
						<span name="포장">포장</span>
						</span>
					</p>
					<p class="t1">
						<span class="tt1 lft fw600 c-black">별내동 1005, 아이파크스타타워123ㄴㄴㄴㄴㄴㄴㄴㄴㄴㄴ</span>
						<span class="rgh fw800 c-red">-5,400원</span>
					</p>
					<p class="t2">
						<span class="lft"><span class="mr10">음식금액</span>144,000원</span></span>
						<span class="rgh" name="딜리온">딜리온
						<span>ㅣ</span>
						<span name="이형규기사">이형규기사</span>
						</span>
					</p>
				</div>
				<div class="l_card">
					<p class="t0">
						<span class="lft">01515050</span>
						<span class="rgh" name="배민">배민
						<span>ㅣ</span>
						<span name="선결제">선결제</span>
						<span>ㅣ</span>
						<span name="포장">포장</span>
						</span>
					</p>
					<p class="t1">
						<span class="tt1 lft fw600 c-black">별내동 1005, 아이파크스타타워123ㄴㄴㄴㄴㄴㄴㄴㄴㄴㄴ</span>
						<span class="rgh fw800 c-red">-5,400원</span>
					</p>
					<p class="t2">
						<span class="lft"><span class="mr10">음식금액</span>144,000원</span></span>
						<span class="rgh" name="딜리온">딜리온
						<span>ㅣ</span>
						<span name="이형규기사">이형규기사</span>
						</span>
					</p>
				</div>
				
			</li>
		</ul>
	</div>
</div><!--//container -->




<!-- 팝업 : 결제취소 -->
<div id="popAlert1" class="layerPopup2 pop_alert">
	<div class="popup">
		<div class="p_cont">
			<p class="t1"><span class="c-red">결제취소</span> 하시겠습니까?</p>
		</div>

		<div class="p_botm">
			<button type="button" class="btn-pk gray"><span>예</span></button>
			<button type="button" class="btn-pk red b-close2"><span>아니오</span></button>
		</div>
	</div>
</div>



<!-- 팝업 : 년월선택 -->
<div id="popYears" class="layerPopup ty2 pop_years">
	<div class="popup">
		<div class="p_head">
			<h2 class="tit">조회기간 선택</h2>
			<button type="button" class="b-close btn_p_close"><span>닫기</span></button>
		</div>

		<div class="p_cont  pt10 pb10">

			<div class="d-flex">
				<div class="lst_swiper swiper1" id="sel_yyyy">
					<div class="lst_line swiper-wrapper">
						<div class="swiper-slide" value="2021"><a href="javascript:;">2021</a></div>
						<div class="swiper-slide current" value="2022"><a href="javascript:;">2022</a></div><!-- 현재 연도에 current 추가 -->
						<div class="swiper-slide" value="2023"><a href="javascript:;">2023</a></div>
					</div>
				</div>

				<div class="lst_swiper ml10 swiper2" id="sel_mm">
					<div class="lst_line swiper-wrapper">
						<div class="swiper-slide" value="01"><a href="javascript:;">1</a></div>
						<div class="swiper-slide" value="02"><a href="javascript:;">2</a></div>
						<div class="swiper-slide" value="03"><a href="javascript:;">3</a></div>
						<div class="swiper-slide" value="04"><a href="javascript:;">4</a></div>
						<div class="swiper-slide" value="05"><a href="javascript:;">5</a></div>
						<div class="swiper-slide" value="06"><a href="javascript:;">6</a></div>
						<div class="swiper-slide" value="07"><a href="javascript:;">7</a></div>
						<div class="swiper-slide" value="08"><a href="javascript:;">8</a></div>
						<div class="swiper-slide current" value="09"><a href="javascript:;">9</a></div><!-- 현재 월에 current 추가 -->
						<div class="swiper-slide" value="10"><a href="javascript:;">10</a></div>
						<div class="swiper-slide" value="11"><a href="javascript:;">11</a></div>
						<div class="swiper-slide" value="12"><a href="javascript:;">12</a></div>
					</div>
				</div>
			</div>

		</div>


		<div class="p_botm">
			<button type="button" class="btn-pk red" id="btn_search_dt"><span>검색</span></button>
		</div>
	</div>
</div>



<!-- 팝업 : 조회설정 -->
<div id="popSetting" class="layerPopup ty2 pop_setting">
	<div class="popup">
		
		<div class="p_head">
			<h2 class="tit">조회 설정</h2>
			<button type="button" class="b-close btn_p_close"><span>닫기</span></button>
		</div>

		<div class="p_cont">
			<p class="t1 pt10">결제수단</p>
			<div class="lst_radiotx">
				<label class="inp_radiotx"><input type="radio" name="rdo_price_type" value="" checked><span>전체</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_price_type" value="1" ><span>카드</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_price_type" value="0" ><span>현금</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_price_type" value="2" ><span>선결제</span></label>
			</div>
		</div>

		<div class="p_cont">
			<p class="t1 pt10">배달대행</p>
			<div class="lst_radiotx">
				<label class="inp_radiotx"><input type="radio" name="rdo_dv_agent" value="" checked><span>전체</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_dv_agent" value="생각대로" ><span>생각대로</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_dv_agent" value="바로고" ><span>바로고</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_dv_agent" value="부릉" ><span>부릉</span></label>
			</div>
		</div>

		<div class="p_cont">
			<p class="t1 pt10">거래내역</p>
			<div class="lst_radiotx">
				<label class="inp_radiotx"><input type="radio" name="rdo_orderby" value="desc" checked><span>최신순</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_orderby" value="amt" ><span>금액순</span></label>
				<label class="inp_radiotx"><input type="radio" name="rdo_orderby" value="asc" ><span>과거순</span></label>
			</div>
		</div>

		<div class="p_botm">
			<button type="button" class="btn-pk red"  id="btn_search_set"><span>검색</span></button>
		</div>

	</div>
</div>

<!-- 메인 js -->
<script src="js/main.js"></script>


<script>

	const HOST = "http://203.248.18.198:8091";  
	//const HOST = "http://localhost:8091"; 


	var v_page_cnt = 99999;
	var v_page_no = 1;
	var tot_page = 1;
	var v_orderby = "desc";
	//var card_user_id = "k3950302135";
	var v_user_id = "k8208601294004";
	var dayCurIdx = 1;
	var v_card_type = "";
	var v_yyyymm = "2022-09";
	var v_mm = "09";


	$("#btn_search_dt").on("click", function(){

		var yyyyIndex = swiper2[0].realIndex;
		var mmIndex = swiper2[1].realIndex;

		var yyyy = 2021 + yyyyIndex;
		var mm = 1 + mmIndex;


		$("#sel_yyyymm").text(yyyy+"년 "+mm+"월");

		if(mm<10) mm = "0"+mm;

		v_mm = mm;

		v_yyyymm = yyyy +"-"+ mm;


		search_cnt();



		if ($("#popYears").hasClass("ty2")){
			$("#popYears").hide();
		} else {
			$("#popYears").hide(0, function(){
				$(this).find(".popup").animate({bottom:'-100%'}, 100);
			});
		}

		$("body").removeClass("popfix");
		$(".popup_dim").remove(); 

	});
	 


	$("#btn_search_set").on("click", function(){




		if ($("#popSetting").hasClass("ty2")){
			$("#popSetting").hide();
		} else {
			$("#popSetting").hide(0, function(){
				$(this).find(".popup").animate({bottom:'-100%'}, 100);
			});
		}

		$("body").removeClass("popfix");
		$(".popup_dim").remove();

		v_orderby = $("#rdo_orderby").val();


		search_cnt();
		//search();

	});

	$("#btn_refresh").click( function() {
		search_cnt();
		//search();
	});
	

	//카드내역 상세
function prdView(e){
var obj = $(e);
//debugger

$(".l_card").removeClass("active");
obj.parents(".l_card").addClass("active");

$("#pop_appr_no").html(obj.attr("appr_no"));
$("#pop_card_nm").html(obj.attr("card_nm"));
$("#pop_card_no").html(obj.attr("card_no"));
$("#pop_tran_date").html(obj.attr("tran_date"));
$("#pop_pay_date").html(obj.attr("pay_date")); 
$("#pop_card_kind").html(obj.attr("card_kind"));

$("#pop_purc_amt_title").html(obj.attr("purc_amt"));
$("#pop_purc_amt").html(obj.attr("purc_amt"));
$("#pop_total_fees").html(obj.attr("total_fees"));
$("#pop_pay_amt").html(obj.attr("pay_amt"));
$("#pop_pay_yn").html(obj.attr("pay_yn"));
$("#pop_store_nm").html(obj.attr("store_nm"));



openLayerPopup('popView'); return false;
}


function search_cnt() {

	//debugger



	v_page_no = 1;
	var v_dv_status = "";
	var v_pack_type = "";

	var v_dt_from ="2022-09-01";
	var v_dt_to   ="2022-09-20";

	v_dt_from = v_yyyymm+"-01";

	if(v_mm == "02"){
		v_dt_to   = v_yyyymm+"-28";
	}
	if(v_mm == "01" || v_mm == "03" || v_mm == "05" || v_mm == "07" || v_mm == "08"|| v_mm == "10"|| v_mm == "12"){

		v_dt_to   = v_yyyymm+"-31";
	}
	if(v_mm == "04" || v_mm == "06" || v_mm == "09" || v_mm == "07"|| v_mm == "09" || v_mm == "11"){

		v_dt_to   = v_yyyymm+"-30";
	}



	var v_search_keyword = ""; 
	var v_price_type = "";


	var cb_dtl_pruc_no = "";            
	if($("input[name='rdo_pay_yn']:checked").val() == "N"){
		cb_dtl_pruc_no = "Y";
	}
	var cb_dtl_pruc_ok = "";            
	if($("input[name='rdo_pay_yn']:checked").val() == "Y"){
		cb_dtl_pruc_ok = "Y";
	} 

	var rdo_card_type = "";      

	var cb_dtl_card1  = "";    
	if($("input[name='rdo_card_type']:checked").val() == "1"){
		cb_dtl_card1 = "Y";
	} 
	var cb_dtl_card2 = "";            
	if($("input[name='rdo_card_type']:checked").val() == "2"){
		cb_dtl_card2 = "Y";
	} 
	v_orderby = $("input[name='rdo_orderby']:checked").val(); 


	var dv_agent  = $("input[name='rdo_dv_agent']:checked").val(); 

	var v_price_type  = $("input[name='rdo_price_type']:checked").val(); 
	var v_memo = "";//$("#MEMO").val(); 
	v_memo = $("input[name='rdo_dv_agent']:checked").val(); 



	var v_data = "{v_shopId: '" + v_user_id 
			+ "',v_dt_from:'" + v_dt_from 
			+ "',v_dt_to:'" + v_dt_to 
			+ "',v_page_cnt:'" + v_page_cnt 
			+ "',v_page_no:'" + v_page_no 
			+ "',v_price_type:'" + v_price_type 
			+ "',v_memo:'" + v_memo +"'}";

 


	//alert("조회 요청");
	//run_waitMe($('#div_main'), 1, "roundBounce");
	$.ajax({
		type: "POST",
		url: HOST + '/api/searchDvHist2_cnt',
		data: v_data,
		contentType: "application/json; charset=utf-8",
		dataType: "json",
		success: function (list) {
			//debugger;                    
			//alert("조회 성공");
							
			
			
			$("#price_total").html(list[0]["price_total"].toLocaleString('ko-KR'));
			$("#tot_cnt").html(list[0]["cnt"].toLocaleString('ko-KR')+"건");
			$("#tot_cnt2").html(list[0]["cnt"].toLocaleString('ko-KR'));


			tot_page = Math.ceil(list[0]["cnt"] / v_page_cnt);

			$("#txt_page_at").val(v_page_no);
			$("#txt_page_tot").html("of "+tot_page);
			
			//$('#div_main').waitMe('hide');
			search();

		},
		error: function (xhr, status, error) {
			//alert("조회 실패");
			//debugger;
			//$('#div_main').waitMe('hide');

		}
	});
	}

	

	function search() {
		//debugger;

		// var id = $('#username').val();
		// var pass = $('#password').val();

		 
		var v_dv_status = "";
		var v_pack_type = "";

		var v_dt_from ="2022-09-01";
		var v_dt_to   ="2022-09-20";
	v_dt_from = v_yyyymm+"-01";

	if(v_mm == "02"){
		v_dt_to   = v_yyyymm+"-28";
	}
	if(v_mm == "01" || v_mm == "03" || v_mm == "05" || v_mm == "07" || v_mm == "08"|| v_mm == "10"|| v_mm == "12"){

		v_dt_to   = v_yyyymm+"-31";
	}
	if(v_mm == "04" || v_mm == "06" || v_mm == "09" || v_mm == "07"|| v_mm == "09" || v_mm == "11"){

		v_dt_to   = v_yyyymm+"-30";
	}


		var v_search_keyword = ""; 
		var v_pay_in_out = "";

		var cb_dtl_pruc_no = "";            
		if($("input[name='rdo_pay_yn']:checked").val() == "N"){
			cb_dtl_pruc_no = "Y";
		}
		var cb_dtl_pruc_ok = "";            
		if($("input[name='rdo_pay_yn']:checked").val() == "Y"){
			cb_dtl_pruc_ok = "Y";
		} 

		var rdo_card_type = "";      

		var cb_dtl_card1  = "";    
		if($("input[name='rdo_card_type']:checked").val() == "1"){
			cb_dtl_card1 = "Y";
		} 
		var cb_dtl_card2 = "";            
		if($("input[name='rdo_card_type']:checked").val() == "2"){
			cb_dtl_card2 = "Y";
		} 
		v_orderby = $("input[name='rdo_orderby']:checked").val(); 

		var cbo_card_nm = "";


		

		var dv_agent  = $("input[name='rdo_dv_agent']:checked").val(); 

		var v_price_type  = $("input[name='rdo_price_type']:checked").val(); 
		var v_memo = "";//$("#MEMO").val(); 
		v_memo = $("input[name='rdo_dv_agent']:checked").val(); 


		


		var v_data = "{v_shopId: '" + v_user_id 
				  + "',v_dt_from:'" + v_dt_from 
				  + "',v_dt_to:'" + v_dt_to 
				  + "',v_page_cnt:'" + v_page_cnt 
				  + "',v_page_no:'" + v_page_no 
				  + "',v_orderby:'" + v_orderby 
					+ "',v_price_type:'" + v_price_type 
					+ "',v_pay_in_out:'" + v_pay_in_out 
				  + "',v_memo:'" + v_memo +"'}";

				  
		$.ajax({
			type: "POST",
			url: HOST + '/api/searchDvHist2',
			data: v_data,
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			success: function (msg) {
				//debugger;                    
				//alert("조회 성공");
				
				myList = msg;       
				var show_date = "";        
				var show_date_pre = "";        
				var temp_html = "";
				$("#list_main").html("");                     
				for (var i = 0; i < myList.length; i++) { 
					
					show_date = myList[i]["dt_md"];

					if(show_date_pre != show_date){
						temp_html = temp_html + ` <li>
									<p class="t_day">`+myList[i]["dt_md"]+`</p>`;
					}

					var order_channel = myList[i]["order_channel"];
                        var dv_typeNm = myList[i]["dv_typeNm"];
                        var price_typeNm = myList[i]["price_typeNm"];
                        var price_typeNm = myList[i]["price_typeNm"];

						
                        var fee_total = parseInt(myList[i]["fee_total"]);
                        var price_total = parseInt(myList[i]["price_total"]); 
                        

                        fee_total = fee_total * -1;
                        price_total = "+" + price_total.toLocaleString('ko-KR')
 
					
					temp_html = temp_html + `<div class="l_card">
											<p class="t0">
												<span class="lft">`+myList[i]["orderno"]+`</span>
												<span class="rgh" name="`+myList[i]["order_channel"]+`">`+myList[i]["order_channel"]+`
												<span>ㅣ</span>
												<span name="`+myList[i]["price_typeNm"]+`">`+myList[i]["price_typeNm"]+`</span>
												<span>ㅣ</span>
												<span name="`+myList[i]["dv_typeNm"]+`">`+myList[i]["dv_typeNm"]+`</span>
												</span>
											</p>
											<p class="t1">
												<span class="tt1 lft fw600 c-black">`+myList[i]["dest_short_name"]+`</span>
												<span class="rgh fw800 c-red">`+fee_total.toLocaleString('ko-KR')+`원</span>
											</p>
											<p class="t2">
												<span class="lft"><span class="mr10">음식금액</span>`+parseInt(myList[i]["price_total"]).toLocaleString('ko-KR')+`원</span></span>
												<span class="rgh" name="`+myList[i]["agent_name"]+`">`+myList[i]["agent_name"]+`
												<span>ㅣ</span>
												<span name="`+myList[i]["deliver_name"]+`">`+myList[i]["deliver_name"]+`</span>
												</span>
											</p>
										</div>`;
 
					if(i== myList.length-1 || show_date != myList[i+1]["dt_md"] ){
						temp_html = temp_html + '</li>';
					}

					show_date_pre = show_date;
				}

				
				$("#list_main").append(temp_html);
				 

			},
			error: function (xhr, status, error) {
				//alert("조회 실패");
				$('#div_main').waitMe('hide');
				//debugger;

			}
		});
	}





search_cnt();

</script>

</div><!--  //wrap -->
</body>
</html>